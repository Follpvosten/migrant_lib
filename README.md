# migrant_lib

[![Build Status](https://travis-ci.org/jaemk/migrant.svg?branch=master)](https://travis-ci.org/jaemk/migrant)
[![crates.io:migrant_lib](https://img.shields.io/crates/v/migrant_lib.svg?label=migrant_lib)](https://crates.io/crates/migrant_lib)
[![docs](https://docs.rs/migrant_lib/badge.svg)](https://docs.rs/migrant_lib)

> Embeddable migration management

`migrant_lib` allows defining and embedding management of migrations in your compiled application.

- Migrations can be defined as files or functions.
- File migrations can be either read from files at runtime or embedded in your executable at compile time.
- Migration tags must all be unique and may only contain the characters `[a-z0-9-]`.
- Function migrations must have the signature `fn(DbConn) -> Result<(), Box<std::error::Error>>`.
  See the [embedded_programmable](https://github.com/jaemk/migrant_lib/blob/master/examples/embedded_programmable.rs)
  example for a working sample of function migrations.
- When working with embedded and function migrations, the respective database feature must be
  enabled (`postgresql` / `sqlite`).
- When database features are enabled, the entirety of the database-specific connection library will
  be re-exported in the `types` module.


```rust
fn up(_: DbConn) -> Result<(), Box<std::error::Error>> {
    print!(" Up!");
    Ok(())
}

fn down(_: DbConn) -> Result<(), Box<std::error::Error>> {
    print!(" Down!");
    Ok(())
}

config.use_migrations(vec![
    FileMigration::with_tag("initial")?
        .up("migrations/embedded/initial/up.sql")?
        .down("migrations/embedded/initial/down.sql")?
        .boxed(),
    EmbeddedMigration::with_tag("second")?
        .up(include_str!("../migrations/embedded/second/up.sql"))
        .down(include_str!("../migrations/embedded/second/down.sql"))
        .boxed(),
    FnMigration::with_tag("custom")?
        .up(up)
        .down(down)
        .boxed(),
])?;
```

----

Migrations management identical to the [`migrant`](https://github.com/jaemk/migrant) cli tool can also be embedded.
This method only supports file-based migrations and those migration files must be generated by `migrant_lib::new`
(or the `migrant` cli). This is required because migration order is implied by file names which must follow
a specific format and contain a valid timestamp.

See the [migrant_cli_compatible](https://github.com/jaemk/migrant_lib/blob/master/examples/migrant_cli_compatible.rs)
example for a working sample.


License: MIT
